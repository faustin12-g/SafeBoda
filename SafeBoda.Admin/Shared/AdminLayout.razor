@inject SafeBoda.Admin.Services.AuthService AuthService
@inject NavigationManager Navigation

@if (!isAuthenticated)
{
    <div class="d-flex justify-content-center align-items-center" style="min-height: 100vh;">
        <div class="text-center">
            <div class="spinner-border text-success" role="status" style="width: 3rem; height: 3rem;"></div>
            <p class="mt-3 text-muted">Checking authentication...</p>
        </div>
    </div>
}
else
{
    <div class="d-flex admin-layout">
        <Sidebar CurrentPage="@CurrentPage" />
        
        <div class="flex-grow-1 main-content">
            @ChildContent
        </div>
    </div>
}

<style>
    .admin-layout {
        min-height: 100vh;
        background: #f5f7fa;
    }

    .main-content {
        padding: 2rem;
        overflow-x: hidden;
        transition: margin-left 0.3s ease;
    }

    @@media (max-width: 768px) {
        .main-content {
            padding: 1rem;
            width: 100%;
        }
    }
</style>

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public string CurrentPage { get; set; } = "";

    private bool isAuthenticated = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            isAuthenticated = await AuthService.IsAuthenticatedAsync();
            
            if (!isAuthenticated)
            {
                Navigation.NavigateTo("/login");
                return;
            }

            StateHasChanged();
        }
    }
}
